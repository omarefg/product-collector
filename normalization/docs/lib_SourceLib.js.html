<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/SourceLib.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/SourceLib.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const productSearchCriteria = require('../utils/mocks/productSearchCriteria.json')

/**
 * Esta es la clase base que nos permite definir los metodos
 * para reducir la cantidad de datos dependiento de su origen
 */
class SourceLib {
    /**
     * Este es le metodo de normalización, su objetivo es
     * reducir el numero items aplicando criterios de busqueda y filtros.
     * @param {number} id - ID del item
     * @param {string} source - Fuente de la información
     * @param {array} data - Datos a ser normalizados
     * @param {string} date - Fecha de la busqueda
     */
    normalize (id, source, data, date) {
        const criteria = productSearchCriteria[id]
        let normalizedData = this._simplifyData(id, source, data, date)
        normalizedData = this._getVariant(normalizedData, criteria.filters.variants)
        normalizedData = this._applyCriteria(normalizedData, criteria.filters)
        return normalizedData
    }

    _normCondition (nameToChange, conditionsToReplace) {
        return conditionsToReplace[nameToChange.toLowerCase()] || ''
    }

    _getVariant (data, optionsToFind) {
        const regExpVariants = new RegExp(optionsToFind.join('|', 'i'))
        return {
            ...data,
            results: data.results
                .filter(item => regExpVariants.test(item.title))
                .map(item => {
                    const itemObj = {
                        ...item,
                        variant: item.title.match(regExpVariants)[0]
                    }
                    delete itemObj.title
                    return itemObj
                })
        }
    }

    _applyCriteria (data, filters) {
        const keysFilters = Object.keys(filters)
        // Example -> itemAttributes = [ 'condition', 'model', 'variant' ] without 's' in the end
        const itemAttributes = keysFilters.map(item => item.slice(0, -1))
        const regExpList = keysFilters.map(keyFilter => new RegExp(filters[keyFilter].join('|'), 'i'))

        return {
            ...data,
            results: data.results.filter(item => {
                const testList = itemAttributes.filter((attribute, index) =>
                    regExpList[index].test(item[attribute])
                )
                return testList.length === itemAttributes.length
            })
        }
    }
}

module.exports = SourceLib
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Estructura del proceso</a></h2><h3>Modules</h3><ul><li><a href="module-bodyDataHandler.html">bodyDataHandler</a></li><li><a href="module-Data-manager.html">Data-manager</a></li><li><a href="module-router.html">router</a></li><li><a href="module-tokenHandler.html">tokenHandler</a></li></ul><h3>Classes</h3><ul><li><a href="DataManagerService.html">DataManagerService</a></li><li><a href="MercadoLibreLib.html">MercadoLibreLib</a></li><li><a href="SourceLib.html">SourceLib</a></li></ul>
</nav>

<br class="clear">

<footer>
    Estoy docuementando a lo Pro <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Mon Apr 13 2020 19:40:20 GMT-0500 (GMT-05:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
